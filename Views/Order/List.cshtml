@model OrderListViewModel
@using ECom_wep_app.Models.Search

@{
    ViewBag.Title = "Orders";
}

<div class="mb-3">
    <div class="fw-bold mb-2">Search</div>

    <form asp-action="List" method="get" class="row g-2 align-items-end">
        <div class="col-12 col-sm-2">
            <input asp-for="Search.Id" class="form-control" placeholder="Id" />
        </div>
        <div class="col-12 col-sm-2">
            <input asp-for="Search.CustomerId" class="form-control" placeholder="Customer Id" />
        </div>
        <div class="col-12 col-sm-2">
            <input asp-for="Search.ProductId" class="form-control" placeholder="Product Id" />
        </div>
        <div class="col-12 col-sm-2">
            <input asp-for="Search.Quantity" class="form-control" placeholder="Quantity" />
        </div>
        <div class="col-12 col-sm-3">
            <input asp-for="Search.OrderDate" type="date" class="form-control" />
        </div>

        <div class="col-12 d-flex gap-2 mt-2">
            <button class="btn btn-outline-secondary" type="submit">
                <i class="fas fa-search"></i> Search
            </button>
            <a asp-action="List" class="btn btn-link text-decoration-none">Reset</a>
        </div>
    </form>
</div>

<div class="d-flex justify-content-end mb-3">
    <a href="@Url.Action("Create", "Order")" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add New
    </a>
</div>

<table class="table table-bordered table-hover table-striped align-middle text-center">
    <thead class="table-dark">
        <tr>
            <th style="width:90px">Id</th>
            <th style="min-width:140px">Customer Id</th>
            <th style="min-width:140px">Product Id</th>
            <th style="min-width:120px">Quantity</th>
            <th style="min-width:180px">Order Date</th>
            <th style="width:50px"></th>
            <th style="width:50px"></th>
            <th style="width:50px"></th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Orders?.Items?.Count > 0)
        {
            foreach (var item in Model.Orders.Items)
            {
                <tr>
                    <td>@item.Id</td>
                    <td>@item.CustomerId</td>
                    <td>@item.ProductId</td>
                    <td>@item.Quantity</td>
                    <td>@item.OrderDate.ToString("yyyy-MM-dd")</td>
                    <td>
                        <a href="@Url.Action("Details", "Order", new { id = item.Id })"
                           class="btn btn-sm btn-info" title="Details">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                    <td>
                        <a href="@Url.Action("Update", "Order", new { id = item.Id })"
                           class="btn btn-sm btn-secondary" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                    </td>
                    <td>
                        <form asp-action="Delete"
                              asp-controller="Order"
                              asp-route-id="@item.Id"
                              method="post"
                              style="display:inline;">
                            <button type="button"
                                    class="btn btn-sm btn-danger"
                                    title="Delete"
                                    onclick="confirmDelete(this)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="8" class="text-center text-muted">No orders found.</td>
            </tr>
        }
    </tbody>
</table>

@await Html.PartialAsync("_Page", Model.Orders)

@await Html.PartialAsync("_GeneralPopup")

@section Scripts {
    <script src="~/js/general-popup.js" asp-append-version="true"></script>
    <script>
        function confirmDelete(btn) {
            const form = btn.closest('form');
            GeneralPopup.open(
                'Do you really want to delete this order?',
                () => form.submit(),
                () => {}
            );
        }
    </script>
}
